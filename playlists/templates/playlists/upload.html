{% load static %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<form class="form-horizontal" method="POST" action="" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="row spacer">
        <div class="col-4">
            <p>제목 : {{ playlistform.title }}</p>
            <p>요약 : {{ playlistform.description }}</p>
            <p>상세 : {{ playlistform.detail }}</p>
            <p>메인 사진 : {{ playlistform.main_image }}</p>
            <p>태그 : {{ playlistform.tag_string}}</p>
        </div>
    </div>

    {{ cardformset.management_from }}
    {% for form in cardformset.forms %}
        <div id="form_set">
            <div class="table">
                <input type="hidden" name="form-TOTAL_FORMS" value="1" id="id_form-TOTAL_FORMS"/>
                <input type="hidden" name="form-INITIAL_FORMS" value="0" id="id_form-INITIAL_FORMS"/>
                <input type="hidden" name="form-MAX_NUM_FORMS" id="id_form-MAX_NUM_FORMS"/>
                <table class="no_error">
                    {{ form.as_table }}
                    <p>사진 : <input type="file" name="img-card-{{ forloop.counter0 }}" multiple></p>
                </table>
            </div>
        </div>
    {% endfor %}
    <input type="button" value="카드 추가" id="add_more">

    <div id="empty_form" style="display:none">
        <div class="table">
            <table class="no_error">
                {{ cardformset.empty_form.as_table }}
                <p>사진 : <input type="file" name="image" multiple /></p>
            </table>
            <input id="delete-card-__prefix__" type="button" value="삭제"/>
        </div>
    </div>
    <div class="row spacer">
        <div class="col-4 offset-2">
            <button type="submit" class="save btn btn-default">일정 저장</button>
        </div>
    </div>
    
    
    <script src="{% static 'js/jquery-3.3.1.slim.min.js' %}"></script>
    <script>
        $(document).ready(function() {
            $('#add_more').click(function(){
                var form_idx=$('#id_form-TOTAL_FORMS').val();
                console.log(form_idx)
                $('#form_set')
                    .append(
                        $('#empty_form')
                            .html()
                            .replace(/__prefix__/g, form_idx)
                            .replace('image', `img-card-${form_idx}`)
                    );
                $('#id_form-TOTAL_FORMS').val(parseInt(form_idx)+1);
            }); 
        });
        
    </script>
    
</form>